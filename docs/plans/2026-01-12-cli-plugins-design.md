# CLI Tools Plugin System Design

## Overview

Add four CLI tools to the plugin preset system: **Starship**, **tmux**, **bat**, and **delta**. These follow the same pattern as the existing sketchybar/aerospace plugins: preset selection + user overrides + theme color integration.

## Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                     Plugin System                            │
├─────────────────────────────────────────────────────────────┤
│  bundled-presets/                                           │
│  ├── starship/  (minimal, developer, full)                  │
│  ├── tmux/      (minimal, powerline, pro)                   │
│  ├── bat/       (minimal, default, full)                    │
│  └── delta/     (minimal, side-by-side, full)               │
├─────────────────────────────────────────────────────────────┤
│  User's config directory (~/.config/<tool>/)                │
│  ├── <main-config>        ← Wrapper that sources preset     │
│  └── overrides.<ext>      ← User customizations (survives)  │
├─────────────────────────────────────────────────────────────┤
│  MacTheme current/ directory                                │
│  ├── presets/<tool>/      ← Symlink to active preset        │
│  └── theme/<tool>-colors  ← Theme colors file               │
└─────────────────────────────────────────────────────────────┘
```

**Flow:** User selects preset → MacTheme creates wrapper config → wrapper sources (1) theme colors, (2) preset config, (3) user overrides.

## Plugin Definitions

```typescript
const PLUGIN_DEFINITIONS = {
  starship: {
    displayName: 'Starship',
    binaryPaths: ['/opt/homebrew/bin/starship', '/usr/local/bin/starship'],
    configDir: '~/.config',
    mainConfigFile: 'starship.toml',
    brewPackage: 'starship',
    dependencies: [],
  },
  tmux: {
    displayName: 'tmux',
    binaryPaths: ['/opt/homebrew/bin/tmux', '/usr/local/bin/tmux'],
    configDir: '~',
    mainConfigFile: '.tmux.conf',
    brewPackage: 'tmux',
    dependencies: [],
  },
  bat: {
    displayName: 'bat',
    binaryPaths: ['/opt/homebrew/bin/bat', '/usr/local/bin/bat'],
    configDir: '~/.config/bat',
    mainConfigFile: 'config',
    brewPackage: 'bat',
    dependencies: [],
  },
  delta: {
    displayName: 'delta',
    binaryPaths: ['/opt/homebrew/bin/delta', '/usr/local/bin/delta'],
    configDir: '~',
    mainConfigFile: '.gitconfig',  // Adds [delta] section
    brewPackage: 'git-delta',
    dependencies: [],
  },
}
```

## Presets

### Starship

| Preset | Description |
|--------|-------------|
| **minimal** | Directory + git branch only. Clean, fast. |
| **developer** | Directory + git (with status) + language versions (node/python/rust) + command duration |
| **full** | Everything above + kubernetes, docker, aws, time, battery |

### tmux

| Preset | Description |
|--------|-------------|
| **minimal** | Simple status bar: session name on left, time on right. |
| **powerline** | Powerline-style arrows/separators, window list, git branch, battery, time |
| **pro** | Full-featured: session/window/pane info, git, system stats (cpu/mem), spotify, time |

### bat

| Preset | Description |
|--------|-------------|
| **minimal** | No line numbers, no grid, just syntax highlighting |
| **default** | Line numbers + minimal grid borders |
| **full** | Line numbers + full grid + header with filename |

### delta

| Preset | Description |
|--------|-------------|
| **minimal** | Unified diff, no line numbers, clean |
| **side-by-side** | Side-by-side view with line numbers |
| **full** | Side-by-side + syntax highlighting + decorations |

## Preset File Structure

```
bundled-presets/
├── starship/
│   ├── minimal/
│   │   ├── preset.json
│   │   └── starship.toml
│   ├── developer/
│   │   ├── preset.json
│   │   └── starship.toml
│   └── full/
│       ├── preset.json
│       └── starship.toml
├── tmux/
│   ├── minimal/
│   │   ├── preset.json
│   │   └── tmux.conf
│   ├── powerline/
│   │   ├── preset.json
│   │   └── tmux.conf
│   └── pro/
│       ├── preset.json
│       └── tmux.conf
├── bat/
│   ├── minimal/
│   │   ├── preset.json
│   │   └── config
│   ├── default/
│   │   ├── preset.json
│   │   └── config
│   └── full/
│       ├── preset.json
│       └── config
└── delta/
    ├── minimal/
    │   ├── preset.json
    │   └── delta.gitconfig
    ├── side-by-side/
    │   ├── preset.json
    │   └── delta.gitconfig
    └── full/
        ├── preset.json
        └── delta.gitconfig
```

## Wrapper Config Generation

### Starship (TOML with `$include`)

```toml
# ~/.config/starship.toml - Generated by MacTheme
"$schema" = 'https://starship.rs/config-schema.json'

# Theme colors
[palettes.mactheme]
# ... colors injected here

palette = "mactheme"

# Include preset
"$include" = "~/Library/Application Support/MacTheme/current/presets/starship/starship.toml"

# Include user overrides
"$include" = "~/.config/starship-overrides.toml"
```

### tmux (source-file)

```bash
# ~/.tmux.conf - Generated by MacTheme
source-file "~/Library/Application Support/MacTheme/current/theme/tmux-colors.conf"
source-file "~/Library/Application Support/MacTheme/current/presets/tmux/tmux.conf"
if-shell "test -f ~/.tmux-overrides.conf" "source-file ~/.tmux-overrides.conf"
```

### bat (inline config)

```bash
# ~/.config/bat/config - Generated by MacTheme
--theme="MacTheme"
# ... preset options included inline (bat doesn't support includes)
```

### delta (gitconfig section)

Delta configures via `.gitconfig` `[delta]` section - merged, not replaced.

## UI Changes

Plugins section becomes categorized:

```typescript
const PLUGIN_CATEGORIES = [
  {
    name: 'Status Bars',
    plugins: [
      { name: 'sketchybar', displayName: 'SketchyBar', description: 'Highly customizable macOS status bar' },
    ],
  },
  {
    name: 'Window Management',
    plugins: [
      { name: 'aerospace', displayName: 'AeroSpace', description: 'Tiling window manager with themed borders' },
    ],
  },
  {
    name: 'CLI Tools',
    plugins: [
      { name: 'starship', displayName: 'Starship', description: 'Cross-shell prompt with git integration' },
      { name: 'tmux', displayName: 'tmux', description: 'Terminal multiplexer with themed status bar' },
      { name: 'bat', displayName: 'bat', description: 'Syntax-highlighted cat replacement' },
      { name: 'delta', displayName: 'delta', description: 'Themed git diff viewer' },
    ],
  },
];
```

## Special Handling

### Delta (.gitconfig)

- Delta configures via `~/.gitconfig`, not its own file
- Cannot replace `.gitconfig` - must merge the `[delta]` section
- Backup strategy: save existing `[delta]` section, not whole file
- Implementation: Parse gitconfig, update/insert `[delta]` block, preserve everything else

### Starship (shell integration)

- Starship requires shell init: `eval "$(starship init zsh)"`
- MacTheme should check if this exists in `.zshrc`/`.bashrc`
- If missing, prompt user to add it (don't auto-modify shell rc files)

### tmux (server reload)

- After config change: `tmux source-file ~/.tmux.conf`
- Only works if tmux server is running
- If not running, changes apply on next tmux start

### bat (theme registration)

- bat needs theme registered: `bat cache --build`
- Run this after theme color file changes

## Installation

All tools install via Homebrew when not present:

- `brew install starship`
- `brew install tmux`
- `brew install bat`
- `brew install git-delta`

## Files to Create/Modify

| File | Action |
|------|--------|
| `src/main/handlers/pluginHandlers.ts` | Add 4 plugin definitions |
| `src/renderer/components/ApplicationsView.tsx` | Categorized plugin layout |
| `bundled-presets/starship/**` | Create preset configs |
| `bundled-presets/tmux/**` | Create preset configs |
| `bundled-presets/bat/**` | Create preset configs |
| `bundled-presets/delta/**` | Create preset configs |
| `src/main/themeInstaller.ts` | Add tmux-colors.conf generation |
