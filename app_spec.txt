<project_specification>
  <project_name>MacTheme - Unified macOS Theming System</project_name>

  <overview>
    Build an Electron desktop application for macOS that provides unified theming across multiple applications.
    Inspired by Omarchy's Linux theming system, MacTheme uses a symlink-based architecture where a single
    theme directory contains configuration files for various applications. Switching themes updates a symlink,
    and applications that import from this location automatically pick up the new theme.

    The app provides a beautiful GUI for browsing themes, previewing them, and applying them with one click.
    Users can also create custom themes by mixing and matching colors, and the app generates all necessary
    configuration files automatically.
  </overview>

  <technology_stack>
    <frontend>
      <framework>Electron with React</framework>
      <build_tool>Vite for React bundling</build_tool>
      <styling>Tailwind CSS</styling>
      <state_management>React hooks and context</state_management>
      <icons>Lucide React icons</icons>
    </frontend>
    <backend>
      <runtime>Node.js (Electron main process)</runtime>
      <storage>JSON files for theme data and user preferences</storage>
      <file_system>Node.js fs module for symlink management</file_system>
    </backend>
    <electron>
      <version>Latest stable Electron</version>
      <ipc>Electron IPC for main/renderer communication</ipc>
      <security>Context isolation enabled, nodeIntegration disabled</security>
    </electron>
  </technology_stack>

  <theming_architecture>
    <directory_structure>
      <!-- Built-in themes (bundled with app) -->
      ~/Library/Application Support/MacTheme/themes/
      ├── tokyo-night/
      ├── catppuccin-mocha/
      ├── catppuccin-latte/
      ├── gruvbox-dark/
      ├── gruvbox-light/
      ├── nord/
      ├── dracula/
      ├── one-dark/
      ├── solarized-dark/
      ├── solarized-light/
      └── rose-pine/

      <!-- User's custom themes -->
      ~/Library/Application Support/MacTheme/custom-themes/
      └── my-custom-theme/

      <!-- Active theme symlink -->
      ~/Library/Application Support/MacTheme/current/
      ├── theme -> ../themes/tokyo-night  <!-- Symlink to active theme -->
      └── wallpaper -> ./theme/wallpapers/default.png
    </directory_structure>

    <theme_contents>
      Each theme directory contains configuration files for supported applications:

      | File | Application | Format |
      |------|-------------|--------|
      | `alacritty.toml` | Alacritty terminal | TOML |
      | `kitty.conf` | Kitty terminal | Kitty config |
      | `iterm2.itermcolors` | iTerm2 terminal | XML plist |
      | `warp.yaml` | Warp terminal | YAML |
      | `hyper.js` | Hyper terminal | JavaScript object |
      | `vscode.json` | VS Code settings | JSON |
      | `neovim.lua` | Neovim colorscheme | Lua |
      | `raycast.json` | Raycast launcher | JSON |
      | `bat.conf` | bat (cat replacement) | Config |
      | `delta.gitconfig` | delta (git diff) | Git config |
      | `starship.toml` | Starship prompt | TOML |
      | `zsh-theme.zsh` | Zsh syntax highlighting | Zsh script |
      | `theme.json` | Theme metadata | JSON |
      | `light.mode` | Light theme marker | Empty file (presence-based) |
      | `wallpapers/` | Desktop wallpapers | Directory of images |
    </theme_contents>

    <theme_metadata>
      theme.json contains:
      - name: Display name of the theme
      - author: Theme creator
      - description: Brief description
      - version: Theme version
      - colors: Canonical color palette (used for preview and generation)
        - background: Primary background color
        - foreground: Primary text color
        - cursor: Cursor color
        - selection: Selection background
        - black, red, green, yellow, blue, magenta, cyan, white: ANSI colors
        - brightBlack, brightRed, etc.: Bright ANSI colors
        - accent: Primary accent color
        - border: Border/separator color
      - variants: Optional light/dark variants
      - preview: Path to preview image
    </theme_metadata>

    <application_integration>
      Applications import theme files from the symlinked current theme:

      **Alacritty** (~/.config/alacritty/alacritty.toml):
      ```toml
      import = ["~/Library/Application Support/MacTheme/current/theme/alacritty.toml"]
      ```

      **Kitty** (~/.config/kitty/kitty.conf):
      ```
      include ~/Library/Application Support/MacTheme/current/theme/kitty.conf
      ```

      **Neovim** (~/.config/nvim/lua/plugins/theme.lua):
      ```lua
      dofile(vim.fn.expand("~/Library/Application Support/MacTheme/current/theme/neovim.lua"))
      ```

      **VS Code** (settings.json):
      The app modifies VS Code's settings.json to set the workbench.colorTheme

      **Starship** (~/.config/starship.toml):
      ```toml
      "$include" = "~/Library/Application Support/MacTheme/current/theme/starship.toml"
      ```

      **Wallpaper**:
      Uses macOS osascript/AppleScript to set desktop wallpaper
    </application_integration>
  </theming_architecture>

  <core_features>
    <theme_browser>
      - Grid view of all available themes with previews
      - Search and filter themes by name, colors, or light/dark mode
      - Sort by name, popularity, or recently used
      - Preview theme colors in a modal before applying
      - One-click apply button
      - Mark themes as favorites
      - Import themes from files or URLs
      - Export themes for sharing
    </theme_browser>

    <theme_preview>
      - Live preview panel showing how theme looks in:
        - Terminal (mock terminal with sample output)
        - Code editor (syntax-highlighted code sample)
        - System UI mockup
      - Color palette display with hex values
      - Copy color values to clipboard
      - Preview wallpaper with theme
    </theme_preview>

    <theme_editor>
      - Create new themes from scratch
      - Edit existing themes (creates a copy for built-in themes)
      - Color picker for all palette colors
      - Live preview as you edit
      - Generate all config files automatically from palette
      - Import colors from:
        - Image (extract dominant colors)
        - Hex codes
        - Other theme formats
      - Save as new custom theme
    </theme_editor>

    <application_manager>
      - List of supported applications
      - Toggle which apps should be themed
      - Show installation status for each app
      - Setup wizard for new apps (creates import statements)
      - Instructions for manual setup if needed
      - Detect installed applications automatically
      - Show which config files will be modified
    </application_manager>

    <wallpaper_manager>
      - Each theme can include multiple wallpapers
      - Preview wallpapers in grid
      - Select which wallpaper to use with theme
      - Apply wallpaper to all displays or specific displays
      - Wallpaper scheduling (different wallpaper per time of day)
      - Dynamic wallpaper support (light/dark based on system)
    </wallpaper_manager>

    <quick_switcher>
      - Global keyboard shortcut to open quick switcher (Cmd+Shift+T)
      - Fuzzy search for themes
      - Recent themes list
      - Favorites at top
      - Preview on hover
      - Apply on Enter
    </quick_switcher>

    <auto_switching>
      - Switch themes based on macOS appearance (light/dark mode)
      - Schedule themes for time of day
      - Switch theme based on active application (optional)
      - Sunrise/sunset automatic switching
    </auto_switching>

    <settings>
      - Default light/dark themes for auto-switching
      - Global keyboard shortcuts
      - Startup behavior (open at login, start minimized)
      - Notification preferences
      - Backup and restore themes
      - Import/export preferences
      - Check for theme updates
    </settings>

    <menu_bar_integration>
      - Menu bar icon showing current theme color
      - Quick access to recent themes
      - Toggle between last two themes
      - Open main window
      - Preferences access
    </menu_bar_integration>
  </core_features>

  <ui_layout>
    <main_window>
      - Sidebar navigation (Themes, Editor, Apps, Wallpapers, Settings)
      - Main content area
      - Current theme indicator in title bar
      - Native macOS window controls
      - Vibrancy/transparency effects matching macOS aesthetic
    </main_window>

    <themes_view>
      - Search bar at top
      - Filter chips (All, Light, Dark, Favorites)
      - Grid of theme cards
      - Each card shows:
        - Theme name
        - Color palette preview (5-6 color swatches)
        - Light/dark mode badge
        - Apply button
        - Favorite star
        - Active indicator for current theme
    </themes_view>

    <theme_detail_modal>
      - Large preview of theme
      - Full color palette with labels and hex values
      - Terminal preview
      - Code preview
      - Wallpaper thumbnails
      - Apply/Edit/Favorite buttons
      - Author and description
    </theme_detail_modal>

    <editor_view>
      - Color palette editor on left
      - Live preview on right
      - Color picker popover
      - Preset color schemes to start from
      - Save/Cancel buttons
      - Theme metadata form (name, description, author)
    </editor_view>

    <apps_view>
      - List of supported applications
      - Each row shows:
        - App icon and name
        - Installation status (Installed, Not Found)
        - Integration status (Configured, Needs Setup)
        - Toggle switch to include in theming
        - Setup button for unconfigured apps
    </apps_view>
  </ui_layout>

  <design_system>
    <visual_style>
      - Native macOS appearance with SF Pro font
      - Support for both light and dark mode
      - Vibrancy effects for sidebar
      - Rounded corners matching macOS (10-12px radius)
      - Subtle shadows and depth
      - Smooth 200ms transitions
    </visual_style>

    <color_palette>
      - Adapt to system appearance
      - Accent color follows macOS system accent
      - Neutral grays for UI chrome
      - Theme colors only in previews
    </color_palette>

    <typography>
      - SF Pro for UI text
      - SF Mono for color codes and config snippets
      - Sizes: 11px labels, 13px body, 15px headings, 20px titles
    </typography>

    <spacing>
      - 8px grid system
      - 16px standard padding
      - 12px gaps in grids
      - 24px section margins
    </spacing>
  </design_system>

  <theme_switching_process>
    When user applies a theme:
    1. Update symlink: ~/Library/Application Support/MacTheme/current/theme -> new theme
    2. Update wallpaper symlink if theme has wallpapers
    3. Apply wallpaper via osascript
    4. Notify terminals to reload (if supported):
       - Kitty: kitty @ set-colors
       - Alacritty: Automatic (watches config)
       - iTerm2: AppleScript reload
    5. Update VS Code settings if enabled
    6. Run user-defined hook script if configured
    7. Show notification of successful switch
    8. Update menu bar icon color
  </theme_switching_process>

  <data_storage>
    <preferences>
      ~/Library/Application Support/MacTheme/preferences.json:
      - defaultLightTheme: string
      - defaultDarkTheme: string
      - enabledApps: string[]
      - favorites: string[]
      - recentThemes: string[]
      - keyboardShortcuts: object
      - autoSwitch: { enabled: boolean, mode: 'system' | 'schedule' | 'sunset' }
      - schedule: { light: time, dark: time }
      - startAtLogin: boolean
      - showInMenuBar: boolean
    </preferences>

    <theme_state>
      ~/Library/Application Support/MacTheme/state.json:
      - currentTheme: string
      - currentWallpaper: string
      - lastSwitched: timestamp
    </theme_state>
  </data_storage>

  <ipc_channels>
    Main process handles:
    - theme:list - Get all available themes
    - theme:get - Get specific theme data
    - theme:apply - Apply a theme (update symlinks, notify apps)
    - theme:create - Create new custom theme
    - theme:update - Update custom theme
    - theme:delete - Delete custom theme
    - theme:export - Export theme to file
    - theme:import - Import theme from file
    - wallpaper:apply - Set desktop wallpaper
    - wallpaper:list - List wallpapers in theme
    - apps:detect - Detect installed supported applications
    - apps:setup - Configure app to use theme imports
    - apps:refresh - Reload app theme (where supported)
    - preferences:get - Get user preferences
    - preferences:set - Update user preferences
    - system:appearance - Get current macOS appearance (light/dark)
    - system:on-appearance-change - Subscribe to appearance changes
  </ipc_channels>

  <supported_applications>
    <terminals>
      - Alacritty (toml config, auto-reload on config change)
      - Kitty (kitty.conf, remote control for live reload)
      - iTerm2 (itermcolors xml, AppleScript for reload)
      - Warp (yaml themes, manual reload)
      - Hyper (hyper.js, automatic reload)
      - Terminal.app (limited - via profiles)
    </terminals>

    <editors>
      - VS Code (settings.json colorTheme, extension recommendations)
      - Neovim (lua colorscheme config)
      - Sublime Text (color scheme file)
    </editors>

    <cli_tools>
      - bat (syntax highlighting for cat)
      - delta (git diff highlighter)
      - starship (prompt)
      - zsh-syntax-highlighting
      - fzf (fuzzy finder colors)
      - lazygit
    </cli_tools>

    <launchers>
      - Raycast (theme via extensions/settings)
      - Alfred (theme file)
    </launchers>

    <system>
      - Desktop wallpaper (via osascript)
      - macOS accent color (limited support)
    </system>
  </supported_applications>

  <implementation_steps>
    <step number="1">
      <title>Project Setup and Electron Foundation</title>
      <tasks>
        - Initialize Electron project with React and Vite
        - Set up TypeScript configuration
        - Configure Electron main process with IPC
        - Set up Tailwind CSS
        - Create basic window with native macOS styling
        - Implement context bridge for secure IPC
      </tasks>
    </step>

    <step number="2">
      <title>Theme System Core</title>
      <tasks>
        - Create theme directory structure in Application Support
        - Implement theme loading from directories
        - Build symlink management utilities
        - Create theme metadata parsing
        - Implement theme application logic
        - Bundle initial set of themes (Tokyo Night, Catppuccin, etc.)
      </tasks>
    </step>

    <step number="3">
      <title>Theme Browser UI</title>
      <tasks>
        - Build main layout with sidebar navigation
        - Create theme grid view with cards
        - Implement theme preview modal
        - Add search and filtering
        - Create color palette display
        - Implement favorites system
      </tasks>
    </step>

    <step number="4">
      <title>Theme Application and App Refresh</title>
      <tasks>
        - Implement wallpaper setting via osascript
        - Create app detection for installed applications
        - Build app configuration wizard
        - Implement reload mechanisms for supported apps
        - Create notification system for theme changes
      </tasks>
    </step>

    <step number="5">
      <title>Theme Editor</title>
      <tasks>
        - Build color picker interface
        - Create palette editor
        - Implement live preview
        - Add config file generation from palette
        - Create theme save/export functionality
        - Add color extraction from images
      </tasks>
    </step>

    <step number="6">
      <title>Wallpaper Manager</title>
      <tasks>
        - Create wallpaper gallery view
        - Implement wallpaper selection per theme
        - Add multi-display support
        - Build wallpaper preview
      </tasks>
    </step>

    <step number="7">
      <title>Menu Bar and Quick Switcher</title>
      <tasks>
        - Create menu bar tray icon
        - Build quick switcher overlay
        - Implement global keyboard shortcuts
        - Add recent themes menu
      </tasks>
    </step>

    <step number="8">
      <title>Auto-Switching and Scheduling</title>
      <tasks>
        - Implement macOS appearance change detection
        - Build schedule-based switching
        - Add sunrise/sunset calculation
        - Create preferences for auto-switching
      </tasks>
    </step>

    <step number="9">
      <title>Settings and Polish</title>
      <tasks>
        - Build settings view
        - Implement preferences persistence
        - Add import/export for themes
        - Create onboarding flow
        - Polish UI animations and transitions
        - Add error handling and user feedback
        - Implement startup at login
      </tasks>
    </step>
  </implementation_steps>

  <success_criteria>
    <functionality>
      - Theme switching updates symlink correctly
      - All bundled themes apply without errors
      - Wallpaper setting works on all displays
      - Supported apps reload themes properly
      - Custom theme creation generates valid configs
      - Quick switcher responds to global shortcut
      - Auto-switching works with system appearance
    </functionality>

    <user_experience>
      - Native macOS look and feel
      - Smooth animations throughout
      - Fast theme switching (under 1 second)
      - Intuitive navigation
      - Clear feedback for all actions
      - Helpful error messages
    </user_experience>

    <technical_quality>
      - Clean separation between main and renderer processes
      - Proper IPC security with context isolation
      - Efficient file system operations
      - Graceful handling of missing apps/files
      - Proper cleanup of old symlinks
    </technical_quality>
  </success_criteria>
</project_specification>
